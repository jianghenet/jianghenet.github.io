<html>
<head>
  <meta charset="utf-8">
  <title>Test Feedback</title>
  <script type="text/javascript" src='javascripts/lib.js'></script>
  <script type="text/javascript" src='javascripts/ball.js'></script>
</head>
<body id="body">
  <canvas id='main_canvas' tabindex='1' width='800px' height='600px' style='border-left: 1px dotted #333;border-bottom: 1px dotted #111;'></canvas>
  <form action="" method="get" id='feedback_options'>
    <label>Chose feedback type</label>
    <label><input type="radio" checked=true name="feedback_type" value='1'/>P</label>
    <label><input type="radio" name="feedback_type" value='0'/>0</label>
    <label><input type="radio" name="feedback_type" value='-1'/>N</label>
  </form>
  <script type="text/javascript">
    var canvas = document.getElementById('main_canvas');
    var ctx = canvas.getContext('2d');
        
    var boors = [];
    for(var i = 0; i < 12; i++){
      var x = Math.floor(Math.random()*600 + 50)
      var y = Math.floor(Math.random()*400 + 50);
      var aball = new Ball(x,y, 32);
      boors.push(aball);
    }
    
    function draw_boors(){
      boors.forEach(function(boor){
        draw_ball(boor, '#EEB422');
      })
    }
    
    function check(x, y, r){
      return boors.some(function(coord){
        return (Math.pow((coord.x - x), 2) + Math.pow((coord.y - y), 2)) <= Math.pow((coord.r + r), 2)
      });
    }
    
    var input_x=0, input_y=0;
    var output_x = 0, output_y = 0;
    
    var start = {
      x: 0,
      y: 0
    };

    var ball = new Ball(start.x, start.y, 16)
    
    var SPEED = 1;
    var MAX_X = Math.floor(canvas.width / SPEED);
    var MAX_Y = Math.floor(canvas.height / SPEED);
    console.log(MAX_X, MAX_Y);

    function calc_ball(){
      switch(document.forms.feedback_options.elements.namedItem('feedback_type').value - 0){
        case 1:
            output_x = feedback(input_x, output_x);
            output_y = feedback(input_y, output_y);
            break;
        case 0:
            output_x = no_feedback(input_x, output_x);
            output_y = no_feedback(input_y, output_y);
            break;
        case -1:
            output_x = yell_feedback(input_x, output_x);
            output_y = yell_feedback(input_y, output_y);
            break;
        default: 
            output_x = no_feedback(input_x, output_x);
            output_y = no_feedback(input_y, output_y);
      }
    
      ball.x = start.x + Math.floor(output_x * SPEED);
      if(ball.x > canvas.width){ball.x=canvas.width;}
      
      ball.y = start.y + Math.floor(output_y * SPEED);
      if(ball.y > canvas.height){ball.y = canvas.height}
    }

    function draw() {
      ctx.clearRect(0,0, canvas.width, canvas.height);
    
      draw_boors();
      
      if(check(ball.x, ball.y, ball.r)){
        draw_ball(ball, 'red');
      }else{
        draw_ball(ball, 'blue');
      }
      calc_ball();
      setTimeout(draw, 10);
    }

    canvas.onkeydown = function(evt){
      switch(evt.keyCode){
        case 37:
          left();
          break;
        case 38:
          up();
          break;
        case 39:
          right();
          break;
        case 40:
          down();
          break;
      }
    }

    function up(){
      input_y -= 1;
      if(input_y < 0){
        input_y = 0;
      }
    }
    function down(){
      input_y += 1;
      if(input_y > MAX_Y){
        input_y = MAX_Y;
      }
    }
    function left(){
      input_x -= 1;
      if(input_x < 0){
        input_x = 0;
      }
    }
    function right(){
      input_x += 1;
      if(input_x > MAX_X){
        input_x = MAX_X;
      }
    }

    draw();
  </script>
</body>
</html>
